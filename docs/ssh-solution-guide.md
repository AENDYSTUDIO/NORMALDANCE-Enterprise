# Решение проблемы SSH-подключения к серверу 176.108.246.49

## Проблема
Ошибка при подключении: `Permission denied (publickey)`

## Причина
Несоответствие типов ключей:
- На сервере в `authorized_keys` присутствует только `ssh-rsa` ключ
- Пользователь пытается подключиться с `ssh-ed25519` ключом

## Созданные файлы решения

### 1. Автоматические скрипты

#### `scripts/ssh-setup.sh` - Полный скрипт настройки
```bash
chmod +x scripts/ssh-setup.sh
./scripts/ssh-setup.sh
```

**Функции:**
- Проверка наличия SSH-ключей
- Создание SSH-конфигурации
- Автоматическое добавление ключа на сервер
- Тестирование подключения
- Резервные решения с RSA ключами

#### `scripts/quick-ssh-fix.sh` - Быстрое решение
```bash
chmod +x scripts/quick-ssh-fix.sh
./scripts/quick-ssh-fix.sh
```

**Функции:**
- Быстрая проверка и создание ключей
- Создание конфигурации
- Инструкции по ручному добавлению ключа
- Альтернативные решения

#### `scripts/ssh-key-adder.js` - Node.js скрипт
```bash
node scripts/ssh-key-adder.js
```

**Функции:**
- Кросс-платформенное решение
- Автоматическое создание конфигурации
- Обработка ошибок
- Руководство по ручному добавлению

### 2. Конфигурационные файлы

#### `config/ssh-server-config` - SSH конфигурация
```bash
# Копирование конфигурации
cp config/ssh-server-config ~/.ssh/config

# Или использование напрямую
ssh -F ~/.ssh/config normaldance-server
```

**Доступные хосты:**
- `normaldance-server` - основной с Ed25519 ключом
- `normaldance-server-rsa` - резервный с RSA ключом
- `normaldance-server-debug` - для отладки
- `176.108.246.49` - прямой IP

## Ручные решения

### Вариант 1: Использование существующих ключей

1. **Проверьте существующие ключи:**
```bash
ls -la ~/.ssh/
```

2. **Используйте RSA ключ (если доступен):**
```bash
ssh -i ~/.ssh/id_rsa root@176.108.246.49
# или
ssh normaldance-server-rsa
```

3. **Создайте новый Ed25519 ключ:**
```bash
ssh-keygen -t ed25519 -f ~/.ssh/id_ed25519 -N ""
```

### Вариант 2: Добавление ключа на сервер

#### Метод A: Через ssh-copy-id
```bash
ssh-copy-id -i ~/.ssh/id_ed25519.pub root@176.108.246.49
```

#### Метод B: Ручное добавление
1. Подключитесь к серверу (если есть доступ):
```bash
ssh normaldance-server-rsa
```

2. Добавьте ключ на сервере:
```bash
mkdir -p ~/.ssh
chmod 700 ~/.ssh
echo "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAI..." >> ~/.ssh/authorized_keys
chmod 600 ~/.ssh/authorized_keys
```

#### Метод C: Через администратора сервера
1. Получите публичный ключ:
```bash
cat ~/.ssh/id_ed25519.pub
```

2. Отправьте ключ администратору сервера и попросите добавить его в `~/.ssh/authorized_keys`

### Вариант 3: Проверка и исправление прав доступа

На сервере проверьте:
```bash
# Права на директорию
ls -ld ~/.ssh/
# Должно быть: drwx------ (700)

# Права на authorized_keys
ls -la ~/.ssh/authorized_keys
# Должно быть: -rw------- (600)

# Владелец файлов
stat ~/.ssh/authorized_keys
# Должен принадлежать вашему пользователю
```

Исправление прав:
```bash
chmod 700 ~/.ssh
chmod 600 ~/.ssh/authorized_keys
chown $USER:$USER ~/.ssh -R
```

## Команды для диагностики

### Проверка ключей
```bash
# Просмотр публичных ключей
ssh-keygen -l -f ~/.ssh/id_ed25519.pub
ssh-keygen -l -f ~/.ssh/id_rsa.pub

# Проверка формата ключа
ssh-keygen -l -f ~/.ssh/id_ed25519.pub -E sha256
```

### Отладка подключения
```bash
# Подробный вывод
ssh -vvv normaldance-server

# Только проверка подключения
ssh -T normaldance-server

# Проверка конкретного ключа
ssh -i ~/.ssh/id_ed25519 -v root@176.108.246.49
```

### Проверка сервера
```bash
# Проверка SSH-демона
ssh -v root@176.108.246.49 -o PreferredAuthentications=password

# Проверка поддерживаемых алгоритмов
ssh -Q key-plain root@176.108.246.49
```

## Альтернативные решения

### 1. Использование парольной аутентификации
Если разрешена на сервере:
```bash
ssh root@176.108.246.49
```

### 2. Создание SSH-туннеля
```bash
ssh -L 8080:localhost:80 normaldance-server
```

### 3. Использование PuTTY (Windows)
1. Загрузите приватный ключ в PuTTYgen
2. Сохраните `.ppk` файл
3. Подключитесь через PuTTY с указанием ключа

## Шаги для окончательного решения

1. **Запустите автоматический скрипт:**
```bash
./scripts/ssh-setup.sh
```

2. **Если не помогло, используйте RSA ключ:**
```bash
ssh normaldance-server-rsa
```

3. **Добавьте Ed25519 ключ вручную:**
```bash
# Получите публичный ключ
cat ~/.ssh/id_ed25519.pub

# Подключитесь через RSA и добавьте ключ
ssh normaldance-server-rsa
# На сервере выполните:
mkdir -p ~/.ssh && echo "ваш_публичный_ключ" >> ~/.ssh/authorized_keys && chmod 600 ~/.ssh/authorized_keys
```

4. **Проверьте результат:**
```bash
ssh normaldance-server
```

## Контактная информация
Если ни одно из решений не помогло, свяжитесь с администратором сервера с указанием:
- Вашего публичного SSH-ключа
- Результатов выполнения команд диагностики
- Сообщений об ошибках